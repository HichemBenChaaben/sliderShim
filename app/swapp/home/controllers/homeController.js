define(["swapp","ui-bootstrap","/swapp/home/services/homeService.js","alert-factory","socket-factory","/swapp/menu/directives/menuDirective.js","/swapp/debug/directives/debug.js","/swapp/home/directives/translationFilter.js","/swapp/property/directives/propertyListDirective.js","/swapp/mfChangePassword/directives/password-strength-calculator.js","ng-slider","lodash","ng-messages","/swapp/model/vo/UserDetailsVO.js","/swapp/factories/local-time.js","/swapp/directives/fl-label/angular-floating-labels.js","/swapp/model/appConstants.js","/swapp/model/staticIdentifiers.js","/swapp/directives/alert-notification/alert-directive.js"],function(e){e.registerController("homeController",["$scope","$state","$rootScope","homeService","alertFactory","socket","$modal","UserDetailsVO","localTimeFormat","swAppConstants","swAppMessages","gettextCatalog","gettext","tmhDynamicLocale",function(a,s,t,n,o,r,i,l,d,c,u,g,p,f){function S(e){var a=new Date(e.replace(/ 00:00:00/,"T00:00:00Z"));return a.setHours(0,-a.getTimezoneOffset(),0,0)}a.appConstants=c,a.appMessages=u,t.CSS_PATH="/assets/css/sw-ltr.css",t.BOOTSTRAP_PATH="/assets/css/bootstrap.min.css",t.pageDir="ltr",a.$on("LanguageUpdated",function(){t.CSS_PATH="/assets/css/sw-"+t.pageDir+".css?"+c.RELEASE_VERSION}),t.body={overlay:!1},a.debug=swGlobals.debug,a.loadingView=!1,a.localTimeFormat=d.get(),n.getSessionKeyForInit(),t.closeAlert=o.closeAlert;var m={};changeLanguage=function(){var e=window.localStorage.getItem("language")||t.pageLang;"en_UK"!==e?(g.loadRemote("/../../dist/translations/"+e+".json?"+c.RELEASE_VERSION),g.setCurrentLanguage(e),f.set(e)):(g.setCurrentLanguage(g.baseLanguage),f.set("en-au")),"ar"===e&&(t.pageDir="rtl",t.CSS_PATH="/assets/css/sw-rtl.css?"+c.RELEASE_VERSION,t.BOOTSTRAP_PATH="/assets/css/bootstrap.min.rtl.css"),t.$broadcast("LanguageUpdated"),t.pageLang=e,window.localStorage.setItem("language",e)},changeLanguage(),a.getTranslations=function(s,o){m=s,null===m.data.arrTranslations?n.getModuleTranslations(m.data.modName,o):(o?(e.appEventMsgHash.MSG_MFCHANGEPASSWORD.data.modTranslations=angular.copy(m.data.arrTranslations),t.$broadcast("updatePasswordRules")):(a.modTranslations=angular.copy(m.data.arrTranslations),a.modExceptions=angular.copy(m.data.arrExceptions),t.$broadcast("setModTranslations")),a.loadingView=!1)},a.$on("setLastVisitedState",function(){var e=localStorage.getItem("currentState");e&&"home"!==e&&s.get(e)&&s.transitionTo(e,m.data,{reload:!1,inherit:!0,notify:!0})}),a.$on("updateStateTranslations",function(s,n,o){m.data&&(m.data.arrTranslations=angular.copy(n.translations),m.data.arrExceptions=angular.copy(n.exceptions),o?(e.appEventMsgHash.MSG_MFCHANGEPASSWORD.data.modTranslations=angular.copy(n.translations),t.$broadcast("updatePasswordRules")):(a.modTranslations=angular.copy(n.translations),a.modExceptions=angular.copy(n.exceptions),t.$broadcast("setModTranslations",m.data.displayName)),a.loadingView=!1)}),a.fetchChangePasswordTranslations=function(){a.getTranslations(e.appEventMsgHash.MSG_MFCHANGEPASSWORD,!0)},a.onMenuItemClick=function(e,t){t.hasOwnProperty("submenu")?1===t.submenu.length&&(e=t.submenu[0].module,"mfLanguage"===e||s.transitionTo("home."+e,m.data,{reload:!1,inherit:!0,notify:!0})):"mfLogout"===e?a.onLogoutClick():"mfChangePassword"===e?a.fetchChangePasswordTranslations():s.transitionTo("home."+e,m.data,{reload:!1,inherit:!0,notify:!0})},a.$on("$stateChangeStart",function(e,s,t,n,o){a.loadingView=!0,"home"!==s.name&&localStorage.setItem("currentState",s.name),a.objStateInfo=angular.copy(n),a.modPermissions=angular.copy(s.data.permissions),a.modDisplayName=angular.copy(s.data.displayName),a.getTranslations(s,!1),a.toggleOverlay(!1)}),a.onLogoutClick=function(){var e={task_request:"Session/killSession",data:{session_key:t.userLoginDetailsVO.sessionKey}};r.get(e).then(function(e){window.location="/"})},a.$on("updatePasswordRules",function(e,s){a.showChangePasswordPopup()}),a.showChangePasswordPopup=function(){i.open({templateUrl:"/swapp/mfChangePassword/views/enterPasswordPopUp.tpl.html",controller:h,size:"lg",resolve:{configData:function(){var a={};return a.modPermissions=angular.copy(e.appEventMsgHash.MSG_MFCHANGEPASSWORD.data.permissions),a.modDisplayName=angular.copy(e.appEventMsgHash.MSG_MFCHANGEPASSWORD.data.displayName),a.modTranslations=angular.copy(e.appEventMsgHash.MSG_MFCHANGEPASSWORD.data.modTranslations),a},parentScope:function(){return a},plevel:function(){return a.plevel}},backdrop:"static"})};var h=function(e,a,s,n){e.permissions=s.modPermissions,e.strModuleName=s.modDisplayName,e.strPassword="",e.valueSlider=3,e.id="idSlider",e.showPasswordRulesForSelectedStrength=function(a){e.plevel=a},e.sliderOptions={from:1,to:5,step:1,scale:["weak","|","good","|","strong"],vertical:!1,css:{background:{"background-color":"silver"},before:{"background-color":"red"},"default":{"background-color":"white"},after:{"background-color":"green"},pointer:{"background-color":"blue"}},callback:function(a,s){e.showPasswordRulesForSelectedStrength(a)}},e.rulesParam=l.getRulesForPasswordLevel(t.userLoginDetailsVO.pwdCondition),e.arrStrengthRules=[],e.showPasswordRulesForSelectedStrength(t.userLoginDetailsVO.pwdCondition),e.disabled=!e.disabled,e.submit=function(s){var t={task_request:"User/setUserPw",data:{updatePw:1,pw:s}},n={success:p("The password has been updated successfully."),error:p("The password could not be updated. Please try again.")};r.get(t).then(function(a){1===a?e.addAlert("SUCCESS",n.success):e.addAlert("ERROR",n.error)}),a.dismiss("cancel")},e.cancel=function(){a.dismiss("cancel")}};a.$on("$stateChangeError",function(e,a,t,n,o,r){event.preventDefault(),s.get("home.error").error={destinationState:a,sourceState:n,errorObject:r},s.transitionTo("home.error",m.data,{reload:!1,inherit:!0,notify:!0})}),a.formatDate=function(e){return Array.isArray(e)?angular.forEach(e,function(e){angular.forEach(e,function(a,s){"string"==typeof a&&0===a.search(/\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/)&&(e[s]=S(a))})}):"object"==typeof e?angular.forEach(e,function(a,s){"string"==typeof a&&0===a.search(/\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/)&&(e[s]=S(a))}):"string"==typeof e&&0===e.search(/\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/)&&(e=S(e)),e},a.unformatDate=function(e){function a(e){return 10>e?"0"+e:e}if(Array.isArray(e)){var s=[];angular.forEach(e,function(e){var t={};angular.forEach(e,function(s,n){"number"==typeof s&&13===s.toString().length&&(s=new Date(s)),s instanceof Date&&(e[n]=s.getFullYear()+"-"+a(s.getMonth()+1)+"-"+a(s.getDate())+" 00:00:00"),t[n]=e[n]}),s.push(t)}),e=s}else if("object"==typeof e){var t={};angular.forEach(e,function(s,n){"number"==typeof s&&13===s.toString().length&&(s=new Date(s)),s instanceof Date&&(e[n]=s.getFullYear()+"-"+a(s.getMonth()+1)+"-"+a(s.getDate())+" 00:00:00"),t[n]=e[n]}),e=t}else("number"==typeof e||e instanceof Date)&&("number"==typeof e&&13===e.toString().length&&(e=new Date(e)),e instanceof Date&&(e=e.getFullYear()+"-"+a(e.getMonth()+1)+"-"+a(e.getDate())+" 00:00:00"));return e},a.filterTrigger=function(e,s){e.length>a.appConstants.GRID_ROWS_NUM?(s.gridOptions.enablePaginationControls=!0,s.gridOptions.enableFiltering=!0):(s.gridOptions.enablePaginationControls=!1,s.gridOptions.enableFiltering=!1)},a.toggleOverlay=function(e){t.body.overlay=_.isBoolean(e)?e:!t.body.overlay},a.isOverlayOn=function(){return t.body.overlay},a.initAddressDirective=function(e,s,t){a.$broadcast("updateAddress",{uniqueId:t,pc:e,locality:s})},t.$on("addSessionAlert",function(e,s){a.addAlert("ERROR",s.msgType.toUpperCase())}),a.addAlert=function(e,a){var s=1e4;if(o.closeAlert(0),"SUCCESS"===e&&"INSERT"===a)o.add("success","insertsuccess",s);else if("SUCCESS"===e&&"UPDATE"===a)o.add("success","updatesuccess",s);else if("SUCCESS"===e&&"DELETE"===a)o.add("success","deletesuccess",s);else if("ERROR"===e&&"INSERT"===a)o.add("danger","inserterror",s);else if("ERROR"===e&&"UPDATE"===a)o.add("danger","updateerror",s);else if("ERROR"===e&&"DELETE"===a)o.add("danger","deleteerror",s);else if("SUCCESS"===e&&"SUCCESS"===a)o.add("success","success",s);else if("ERROR"===e&&"ERROR"===a)o.add("danger","error",s);else if("ERROR"===e&&"PROPERTY"===a)o.add("danger","property",s);else if("ERROR"===e&&"SESSIONCLOSE"===a)o.add("danger","sessionclose",s);else if("ERROR"===e&&"SESSIONERROR"===a)o.add("danger","sessionerror",s);else if("ERROR"===e&&"ACCESS"===a)o.add("danger","access",s);else{var t="success"===e.toLowerCase()?"success":"danger";o.add(t,g.getString(a),s)}}}])});