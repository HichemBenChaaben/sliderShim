define(["swapp","socket-factory","/swapp/model/vo/UserDetailsVO.js"],function(e){e.registerService("homeService",function(a,t,n,s){function r(){var e={task_request:"Session/getSession",data:""};a.get(e).then(function(e){t.userLoginDetailsVO=n.apiResponseTransformer(e),f.session_key=e.session_key,f.real_user=e.real_user,g("home",!1);var s={task_request:"Property/getList",data:""};a.get(s).then(function(e){f.propertyList=e,t.$broadcast("SwappInitialised",f)});var r={task_request:"Session/getMenu",data:""};a.get(r).then(function(e){f.menus=e,e=angular.fromJson(e),angular.forEach(e,function(e){l(e)}),t.$broadcast("menusInitialised",e)})})}function o(e){var a={isCreateAllowed:i(e,"C"),isReadAllowed:i(e,"R"),isUpdateAllowed:i(e,"U"),isDeleteAllowed:i(e,"D"),isPrintAllowed:i(e,"P")};return a.isSaveAllowed=a.isCreateAllowed||a.isUpdateAllowed,a}function i(e,a){return String(e.permissions).indexOf(a)>-1?!0:!1}function l(a){if(a.length>0){var n=[];n=u(a,[]);for(var s=0,r=n.length;r>s;s++)if(e.stateProvider.state("home."+n[s].module,{url:n[s].displayname.replace(/\s+/g,""),controller:n[s].module+"Controller",templateUrl:"/swapp/"+n[s].module+"/views/"+n[s].module+"View.html",resolve:{dummy:e.lazy.resolveDependencies(["/swapp/"+n[s].module+"/controllers/"+n[s].module+"Controller.js"])},data:{displayName:n[s].parentPath,permissions:o(n[s]),modName:n[s].module,arrTranslations:null}}),e.appEventMsgHash["MSG_"+n[s].module.toUpperCase()]=n[s].module,"mfChangePassword"===n[s].module){var i={};i.displayName=n[s].displayname,i.permissions=o(n[s]),i.modName=n[s].module,i.arrTranslations=null,e.appEventMsgHash["MSG_"+n[s].module.toUpperCase()]={},e.appEventMsgHash["MSG_"+n[s].module.toUpperCase()].data=i}}t.$broadcast("setLastVisitedState")}function u(e){for(var a=[],t=0,n=e.length;n>t;t++)a=d(e[t],a);return a}function d(e,a){return e.parentPath=e.displayname,e.hasOwnProperty("submenu")?p(e.submenu,a,e.parentPath):m(e)&&a.push(e),a}function p(e,a,t){angular.forEach(e,function(e){e.hasOwnProperty("submenu")?(e.parentPath=t+" / "+e.displayname,p(e.submenu,a,e.parentPath)):m(e)&&(e.parentPath=t+" / "+e.displayname,a.push(e))})}function m(e){return"mf"===e.module.substring(0,2)?e:null}function g(e,n){var s={task_request:"Session/getTranslations",data:{language:t.userLoginDetailsVO.userLanguage,region:t.userLoginDetailsVO.regionId,displayPage:e}};a.get(s).then(function(a){"home"===e&&(f.translation=a.translations),t.$broadcast("updateStateTranslations",a,n)})}function c(){for(var e=s.get(),a=0,t=e.length;t>a;a++){var n=s.get(e[a].name);n&&n.data&&n.data.arrTranslations&&(n.data.arrTranslations=null)}}var f={};return{getSessionKeyForInit:r,getTranslations:function(){return f.translation},getpropertyList:function(){return f.propertyList},addStatesToApplication:l,clearAllTranslations:c,getModuleTranslations:g}})});