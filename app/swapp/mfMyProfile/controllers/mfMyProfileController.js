define(["swapp","socket-factory","ui-bootstrap","socket-factory","/swapp/directives/file-upload/file-upload-directive.js"],function(e){e.registerController("mfMyProfileController",["$scope","$modal","$rootScope","socket","$filter",function(e,t,i,r,a){e.permissions=e.$parent.modPermissions,e.exceptions=e.$parent.modExceptions,e.strModuleName=e.$parent.modDisplayName,e.objProfileData={notificationsUpdated:!0,jobTitleChanged:!1,isdeptChanged:!1,isUserGroupChanged:!1,editPortal:!1,accessPortal:!1,dsa_changed:0,clientId:window.client_id},e.objStateInfo.fromState&&(e.isDisplay="home.mfUserList"===e.objStateInfo.fromState.name),i.editingUser?(i.editingUser.userid||(e.newUser=!0),e.objProfileData.username=i.editingUser.username,e.objProfileData.userId=i.editingUser.userid,i.editingUser=null):(e.objProfileData.username=window.user_name,e.objProfileData.userId=window.user_id),e.$on("fileUploaded",function(t,i){e.objProfileData[i.name]=i.base64}),e.$on("fileDeleted",function(t,i){e.objProfileData[i.name]=null}),e.$on("fileUploadError",function(){e.$parent.addAlert("ERROR","INSERT")}),e.propertyAccessListPopup=function(){t.open({templateUrl:"/swapp/mfMyProfile/views/emailSignaturePopup.html",controller:s,size:"lg",resolve:{},backdrop:"static"})};var o={task_request:"User/getPropertyAccessList",data:""};r.get(o).then(function(t){e.objProfileData.propertyAccessList=angular.fromJson(t)});var s=function(e,t){var i={task_request:"User/getPropertyAccessList",data:""};r.get(i).then(function(t){e.objProfileData.propertyAccessList=angular.fromJson(t)}),e.ok=function(){t.dismiss("cancel")},e.cancel=function(){t.dismiss("cancel")}};e.signatureAuthListPopup=function(e){"undefined"==typeof e&&(e="lg"),t.open({templateUrl:"/swapp/mfMyProfile/views/signatureAuthListPopup.html",controller:n,size:e,resolve:{},backdrop:"static"})};var n=function(e,t){var i={task_request:"User/signatureAuthList",data:""};r.get(i).then(function(t){e.signatureAuthList=t}),e.ok=function(){t.dismiss("cancel")},e.cancel=function(){t.dismiss("cancel")}},l={task_request:"User/getProfile",data:{user_id:e.objProfileData.userId,client_id:window.client_id,user_name:e.objProfileData.username}};r.get(l).then(function(t){if(angular.forEach(t.jobTitleList,function(e){e.title===t.jobTitle&&(t.jobTitle=e.bcmBUnitid)}),e.objProfileData=t,e.origProfilePicture=t.profilepicture,e.origProfileSignature=t.profilesignature,e.objProfileData.userGroup="no",e.objProfileData.dsa_changed=0,e.objProfileData.clientId=window.client_id,i.$broadcast("setFileSrc",{name:"profilepicture",base64:t.profilepicture}),i.$broadcast("setFileSrc",{name:"profilesignature",base64:t.profilesignature}),!e.canEditSecuritySettings){for(var r=0;r<e.objProfileData.departmentList.length;r++)if(e.objProfileData.departmentList[r].bcmBUnitid===e.objProfileData.bcmBUnitid){e.objProfileData.deptName=e.objProfileData.departmentList[r].unitName;break}for(var r=0;r<e.objProfileData.userGroupList.length;r++)if(e.objProfileData.userGroupList[r].groupid===e.objProfileData.groupid){e.objProfileData.userGroupName=e.objProfileData.userGroupList[r].groupName;break}for(var r=0;r<e.objProfileData.jobTitleList.length;r++)if(e.objProfileData.jobTitleList[r].bcmBUnitid===e.objProfileData.bcmBUnitid){e.objProfileData.jobTitle=e.objProfileData.jobTitleList[r].title;break}e.objProfileData.notificationsUpdated=!1}});var l={task_request:"User/getPropertyAccessList",data:""};r.get(l).then(function(t){e.objProfileData.propertyAccessList=t});var u={task_request:"User/getUserList",data:""};r.get(u).then(function(t){var i=angular.fromJson(t),a=i.usernames;e.objProfileData.digitalSigAuth=[];var o={task_request:"User/getDigSigAuthority",data:""};r.get(o).then(function(t){for(var i=angular.fromJson(t),r=0;r<a.length;r++)e.objProfileData.digitalSigAuth.push({user:a[r],auth:a[r],value:!1}),angular.forEach(i,function(t){a[r]===t.user&&(e.objProfileData.digitalSigAuth[r].value=!0)})})}),e.notificationsUpdated=function(){e.objProfileData.notificationsUpdated=!0},e.onSaveProfileDataClick=function(){var t=angular.copy(e.objProfileData);if(t.profilepicture&&e.origProfilePicture!==t.profilepicture){var i={task_request:"User/setProfilePicture",data:{profile_pic_base64:t.profilepicture.replace(/(data).+;base64,/,"")}};r.get(i)}if(t.profilepicture&&e.origProfileSignature!==t.profilesignature){var i={task_request:"User/setProfileSignature",data:{profile_signature_base64:t.profilesignature.replace(/(data).+;base64,/,"")}};r.get(i)}t.departmentList=null,t.jobTitleList=null,t.userGroupList=null,t.propertyAccessList=null,t.userGroupDropdownArr=null,t.profilepicture=null,t.profilesignature=null,t.bcmPositionid=t.jobTitle;var a=[];angular.forEach(t.digitalSigAuth,function(e){e.value&&a.push(e)}),t.digitalSigAuth=a,e.newUser&&(t.userId=null);var i={task_request:"User/setProfile",data:t};r.get(i).then(function(){e.$parent.addAlert("SUCCESS","INSERT")})}}])});