define(["swapp","uiGrid","ui-bootstrap","socket-factory","/swapp/directives/address/address-directives.js","/swapp/directives/validation/arabic-numerals.js","/swapp/directives/address-book/address-book-picker-directive.js","/swapp/directives/format-currency/format-currency.js"],function(e){"use strict";e.registerController("mfPropAssetsController",["$scope","uiGridConstants","socket","$rootScope","$filter","gettext","gettextCatalog",function(e,t,s,a,i,r,n){e.permissions=e.$parent.modPermissions,e.exceptions=e.$parent.modExceptions,e.gridColActionMenu={},e.gridColActionMenu.isDisabled=!1,e.dateFormat=e.$parent.localTimeFormat,e.modal={},e.$on("selectedProperty",function(s,a){g(e.$parent.propertySelected.cts),e.gridApi.core.notifyDataChange(t.dataChange.COLUMN)}),e.$on("LanguageUpdated",function(){e.gridApi.core.notifyDataChange(t.dataChange.ROW)});var o='<div class="ui-grid-cell-contents">{{COL_FIELD | date:getExternalScopes().dateFormat}}</div>',d='<div class="ui-grid-cell-contents"><a ng-click="getExternalScopes().onEditClick(row);" ng-show="getExternalScopes().getPermissions(\'isUpdateAllowed\')">{{COL_FIELD | date:getExternalScopes().dateFormat}}</a></div>',l='<div class="ui-grid-cell-contents"><span class="glyphicon glyphicon-edit" ng-click="getExternalScopes().onEditClick(row);" ng-show="getExternalScopes().getPermissions(\'isUpdateAllowed\')"></span></div>',p='<div class="ui-grid-cell-contents"><span class="glyphicon glyphicon-trash" ng-click="getExternalScopes().deleteAssets(row);" ng-show="getExternalScopes().getPermissions(\'isUpdateAllowed\')"></span></div>',c='<div class="ui-grid-cell-contents"></div>',u='<div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name"   ng-mouseenter="getExternalScopes().rowHover(row)"  ng-mouseleave="getExternalScopes().rowHover(row)" class="ui-grid-cell"   ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell> </div>';e.scopeModel={onEditClick:function(t,s){e.$parent.toggleOverlay(!0),_.size(t)?(e.modal.newPage=!1,e.updateAssets=angular.copy(t.entity),e.updateAssets.updateasset=1,e.$parent.initAddressDirective(e.updateAssets.OPostc,e.updateAssets.OCity,"address1"),e.updateAssets.PerDate=new Date(e.updateAssets.PerDate).getTime(),e.updateAssets.DisDate=new Date(e.updateAssets.DisDate).getTime()):(e.modal.newPage=!0,e.updateAssets=angular.copy({}),e.updateAssets=e.buildDefaultVO(),e.$parent.initAddressDirective("","","address1"),e.updateAssets.insertasset=1)},dateFormat:e.dateFormat,getPermissions:function(t){return e.permissions[t]},decimalFix:function(e){return e>=0?i("currency")(e,""):void 0},deleteAssets:function(t){var s=r("Are you sure you want to delete this entry?");return confirm(n.getString(s))?(e.initiateDeleteRequest(t.entity),!0):!1},rowHover:function(e){e.isSelected=!e.isSelected}},e.initiateDeleteRequest=function(t){for(var a,i=0;i<e.gridOptions.data.length;i++)if(t.AssetID===e.gridOptions.data[i].AssetID){a=i;break}var r={task_request:"Property/removeAssets",data:t};s.get(r).then(function(t){1===t.status?(e.gridOptions.data.splice(a,1),e.$parent.filterTrigger(e.gridOptions.data,e),e.$parent.addAlert("SUCCESS","DELETE")):e.$parent.addAlert("ERROR","DELETE")})},e.$on("updateAddress",function(t,s){e.updateAssets.OPostc=s.pc,e.updateAssets.OCity=s.locality}),e.saveAssets=function(t,a){if(!t)return!1;e.updateAssets.GorP||(e.updateAssets.GorP=!1);var i={task_request:"Property/setAssets",data:e.$parent.unformatDate(e.updateAssets)};s.get(i).then(function(t){if(1===t.status){if(e.modal.newPage===!0)e.updateAssets.AssetID=t.asset_id.result,_.isArray(e.gridOptions.data)||(e.gridOptions.data=[]),e.gridOptions.data.push(e.$parent.formatDate(e.updateAssets)),e.$parent.filterTrigger(e.gridOptions.data,e);else{var s=e.gridOptions.data.indexOf(e.updateAssets);e.gridOptions.data.splice(s,1,e.$parent.formatDate(e.updateAssets))}e.modal.newPage===!0?e.$parent.addAlert("SUCCESS","INSERT"):e.$parent.addAlert("SUCCESS","UPDATE"),a.$setPristine(),a.$setUntouched()}else e.modal.newPage?e.$parent.addAlert("ERROR","INSERT"):e.$parent.addAlert("ERROR","UPDATE")}),e.$parent.toggleOverlay(!1)},e.cancel=function(){e.$parent.toggleOverlay(!1)},e.deleteAsset=function(t){var s=r("Yes");return confirm(n.getString(s))?(e.initiateDeleteRequest(t),e.$parent.toggleOverlay(!1),!0):!1},e.configureGrid=function(){var t={pd:r("Per Date"),ds:r("Description"),ct:r("Cost"),dd:r("Disposal Date"),et:r("Edit")};e.gridOptions={},e.decimalFixCol='<div class="ui-grid-cell-contents text-right">{{getExternalScopes().decimalFix(COL_FIELD)}}</div>';var s={enableVerticalScrollbar:!1,enableHorizontalScrollbar:!1,enableScrolling:!1,useExternalSorting:!0,enableFiltering:!1,enableSorting:!0,rowTemplate:u,enableColumnResizing:!0,paginationPageSizes:[10,25,50,100,150,200],paginationPageSize:10,enableGridMenu:!1,enableRowSelection:!1,enableRowHeaderSelection:!1,multiSelect:!1,exporterLinkLabel:"get your csv here",exporterCsvFilename:"registerOfAssets.csv",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[10,10,10,10]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfHeader:{text:"Register of Assets",style:"headerStyle"},exporterPdfCustomFormatter:function(e){return e.styles.headerStyle={fontSize:22,bold:!0},e.styles.footerStyle={fontSize:10,bold:!0},e},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),columnDefs:[{field:"PerDate",displayName:n.getString(t.pd),visible:!e.exceptions.mfPropAssetsDateOfAcuisition,enableColumnMenu:!1,width:"15%",cellTemplate:d},{field:"Description",displayName:n.getString(t.ds),width:"15%",enableColumnMenu:!1,visible:!e.exceptions.mfPropAssetsDescription},{field:"Cost",displayName:n.getString(t.ct),width:"5%",enableColumnMenu:!1,visible:!e.exceptions.mfPropAssetsCost,cellTemplate:e.decimalFixCol},{field:"DisDate",displayName:n.getString(t.dd),width:"5%",visible:!e.exceptions.mfPropAssetsDisposalDate,enableColumnMenu:!1,cellTemplate:o},{field:"Edit",headerCellTemplate:c,displayName:n.getString(t.et),width:50,visible:e.permissions.isUpdateAllowed,enableFiltering:!1,cellTemplate:l,enableColumnMenu:!1},{field:"Delete",displayName:"Delete",width:50,visible:e.permissions.isDeleteAllowed,headerCellTemplate:c,enableFiltering:!1,enableColumnMenu:!1,cellTemplate:p}]};e.gridOptions=s,e.gridOptions.onRegisterApi=function(t){e.gridApi=t}};var g=function(t){var a={task_request:"Property/getAssets",data:{cts:t}};s.get(a).then(function(t){t.hasOwnProperty("status")?e.$parent.addAlert("ERROR","PROPERTY"):(t=angular.fromJson(t),t=e.$parent.formatDate(t),e.gridOptions.data=t,e.$parent.filterTrigger(e.gridOptions.data,e),e.hasLoaded=!0)})};g(e.$parent.propertySelected.cts),e["export"]=function(t){"csv"===t?e.gridApi.exporter.csvExport("all","all"):"pdf"===t&&e.gridApi.exporter.pdfExport("all","all")},e.buildDefaultVO=function(){var t=(new Date).getTime();return e.userForm=angular.copy({}),{CTS:e.$parent.propertySelected.cts,PerDate:t,Cost:i("currency")(0,""),Oname:"",Description:"",AssetID:0,DisDate:t}},e.addressPickerOpenStatus={isopen:!1},e.toggleDropdown=function(t){t.preventDefault(),t.stopPropagation(),e.addressPickerOpenStatus.isopen||(e.addressPickerOpenStatus.isopen=!e.addressPickerOpenStatus.isopen),a.$broadcast("fetchAddressBookPickerData",e.addressBookConfig)},e.$on("addressKeySet",function(t,s){e.updateAssets.Oname=s.cname,e.updateAssets.OStAddress=s.address,e.updateAssets.OCity=s.location,e.updateAssets.OPostc=s.postcode,e.$parent.initAddressDirective(e.updateAssets.OPostc,e.updateAssets.OCity,"address1"),e.addressPickerOpenStatus.isopen=!e.addressPickerOpenStatus.isopen}),e.addressBookConfig={cts:e.$parent.propertySelected.cts,clientId:a.userLoginDetailsVO.clientId,defaultContactType:"",defaultIndustryType:"",permissions:{isAddAllowed:!0,isEditContactTypeAllowed:!0,isEditIndustryTypeAllowed:!0}},e.configureGrid()}])});