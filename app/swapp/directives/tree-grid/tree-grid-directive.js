define(["swapp","socket-factory","ui-select","ui-bootstrap","alert-factory"],function(e){e.registerDirective("swCompile",["$compile",function(e){return{restrict:"A",link:function(n,r,t){n.$watch(t.swCompile,function(t){var l=e(t),o=l(n);r.append(o)})}}}]),e.registerDirective("swTreeGrid",["$rootScope","socket","$timeout","$compile","alertFactory",function(e,r,t,l,o){return{templateUrl:"/swapp/directives/tree-grid/tree-grid-directive.tpl.html",restrict:"E",replace:!0,scope:{treeData:"=",colDefs:"=",expandOn:"=",onSelect:"&",onClick:"&",initialSelection:"@",treeControl:"=",errorMsgs:"="},link:function(e,r,l){var i=null;l.iconExpand=l.iconExpand?l.iconExpand:"icon-plus  glyphicon glyphicon-folder-close  fa fa-folder",l.iconCollapse=l.iconCollapse?l.iconCollapse:"icon-minus glyphicon glyphicon-folder-open fa fa-folder-open",l.iconLeaf=l.iconLeaf?l.iconLeaf:"icon-file  glyphicon glyphicon-file  fa fa-file",l.expandLevel=l.expandLevel?l.expandLevel:"3",e.expand_level=parseInt(l.expandLevel,10),e.getExpandingProperty=function(){if(l.expandOn)expandingProperty=e.expandOn,e.expandingProperty=e.expandOn;else if(e.treeData.length){for(var n=e.treeData[0],r=Object.keys(n),t=0;t<r.length;t++)if("string"==typeof n[r[t]]){expandingProperty=r[t];break}expandingProperty||(expandingProperty=r[0]),e.expandingProperty=expandingProperty}},e.initConfig=function(){if(!e.treeData)return void o.add("danger",e.errorMsgs.mfUserGroupsDataErrorMsg,5e3);if(!e.treeControl)return void o.add("danger",e.errorMsgs.mfUserGroupsControlErrorMsg,5e3);if(l.colDefs)e.colDefinitions=e.colDefs;else if(e.treeData.length){var n=[],r=e.treeData[0],t=["children","level","expanded",expandingProperty];for(var i in r)-1===t.indexOf(i)&&n.push({field:i});e.colDefinitions=n}},e.initConfig(),e.getExpandingProperty();var c=function(n){for(var r=function(e,t){var l,o,i,c,a;if(n(e,t),null!=e.children){for(c=e.children,a=[],o=0,i=c.length;i>o;o++)l=c[o],a.push(r(l,t+1));return a}},t=e.treeData,l=[],o="",i=0;i<t.length;i++)o=t[i],l.push(r(o,1));return l};e.onSelectBranch=function(n){if(!n)return null!=i&&(i.selected=!1),void(i=null);if(n!==i){if(null!=i&&(i.selected=!1),n.selected=!0,i=n,d(n),null!=n.onSelect)return t(function(){return n.onSelect(n)});if(null!=e.onSelect)return t(function(){return e.onSelect({branch:n})})}},e.on_user_click=function(n){e.onClick&&e.onClick({branch:n})},e.checkNodeIsParent=function(e){return e.children.length>0?!0:!1},e.updateValuesOnAllClick=function(e,n){return n.All=e,n.Create=e,n.Read=e,n.Update=e,n.Delete=e,n.Print=e,n},e.setNodeSelectedProperty=function(n,r,t){n[r]=t;for(var l=0;l<n.children.length;)e.checkNodeIsParent(n.children[l])?("All"===r&&(n.children[l]=e.updateValuesOnAllClick(t,n.children[l])),t?e.setNodeSelectedProperty(n.children[l],r,t):e.setNodeSelectedProperty(n.children[l],r,!1)):(n.children[l][r]=t,"All"===r&&(n.children[l]=e.updateValuesOnAllClick(t,n.children[l]))),l++;return n},e.clickOnCheckbox=function(n,r,t,l){e.checkNodeIsParent(t)?("All"===l&&(t=e.updateValuesOnAllClick(n,t)),n?e.setNodeSelectedProperty(t,l,n):e.setNodeSelectedProperty(t,l,!1)):(t[l]=n,"All"===l&&(t=e.updateValuesOnAllClick(n,t)))},e.onBranchNodeClick=function(n){return n!==i?e.onSelectBranch(n):void 0};var a=function(e){var n;return n=0,e.parent_uid&&c(function(r){return r.uid===e.parent_uid?n=r:void 0}),n},u=function(e,n){var r;return r=a(e),null!=r?(n(r),u(r,n)):void 0},d=function(e){return u(e,function(e){return e.expanded=!0})};e.tree_rows=[],e.on_treeData_change=function(){e.getExpandingProperty();var n;c(function(e,n){return e.uid?void 0:e.uid=""+Math.random()}),c(function(e){var n={},r=[],t=[];if(angular.isArray(e.children)){r=e.children,t=[];for(var l=0;l<r.length;l++)n=r[l],t.push(n.parent_uid=e.uid);return t}}),e.tree_rows=[];var r=function(e){return"string"==typeof e?{label:e,children:[]}:e};c(function(e){var n;if(!e.children)return e.children=[];if(e.children.length>0){for(var t=e.children,l=[],o=0;o<t.length;o++)n=t[o],l.push(r(n));return e.children=l,e.children}return[]});var t=function(n,r,o){var i={},c=!1,a="",u=[],d=[];if(null==r.expanded&&(r.expanded=!1),a=r.children&&0!==r.children.length?r.expanded?l.iconCollapse:l.iconExpand:l.iconLeaf,r.level=n,e.tree_rows.push({level:n,branch:r,label:r[expandingProperty],tree_icon:a,visible:o}),null!=r.children){u=r.children,d=[];for(var s=0;s<u.length;s++)i=u[s],c=o&&r.expanded,d.push(t(n+1,i,c));return d}};_ref=e.treeData,_results=[];for(var o=0;o<_ref.length;o++)n=_ref[o],_results.push(t(1,n,!0));return _results},e.$watch("treeData",e.on_treeData_change,!0),null!=l.initialSelection&&c(function(n){return n.label===l.initialSelection?t(function(){return e.onSelectBranch(b)}):i}),c(function(n,r){return n.level=r,n.expanded=n.level<e.expand_level}),e.bindFunctions=function(){e.treeControl.expand_all=function(){return c(function(e,n){return e.expanded=!0})},e.treeControl.collapse_all=function(){return c(function(e,n){return e.expanded=!1})},e.treeControl.get_first_branch=function(){return n=e.treeData.length,n>0?e.treeData[0]:null},e.treeControl.select_first_branch=function(){var e;return e=tree.get_first_branch(),tree.onSelectBranch(e)},e.treeControl.get_selected_branch=function(){return i},e.treeControl.get_parent_branch=function(e){return a(e)},e.treeControl.onSelectBranch=function(n){return e.onSelectBranch(n),n},e.treeControl.get_children=function(e){return e.children},e.treeControl.select_parent_branch=function(n){var r;return null==n&&(n=e.treeControl.get_selected_branch()),null!=n&&(r=e.treeControl.get_parent_branch(n),null!=r)?(e.treeControl.onSelectBranch(r),r):i},e.treeControl.add_branch=function(n,r){return null!=n?(n.children.push(r),n.expanded=!0):e.treeData.push(r),r},e.treeControl.add_root_branch=function(n){return e.treeControl.add_branch(null,n),n},e.treeControl.expand_branch=function(n){return null==n&&(n=e.treeControl.get_selected_branch()),null!=n?(n.expanded=!0,n):i},e.treeControl.collapse_branch=function(e){return null==e&&(e=i),null!=e?(e.expanded=!1,e):i},e.treeControl.get_siblings=function(n){var r,t;return null==n&&(n=i),null!=n?(r=e.treeControl.get_parent_branch(n),t=r?r.children:e.treeData):i},e.treeControl.get_next_sibling=function(n){var r,t,l;return null==n&&(n=i),null!=n&&(l=e.treeControl.get_siblings(n),t=l.length,r=l.indexOf(n),t>r)?l[r+1]:i},e.treeControl.get_prev_sibling=function(r){var t,l;return null==r&&(r=i),l=e.treeControl.get_siblings(b),n=l.length,t=l.indexOf(r),t>0?l[t-1]:i},e.treeControl.select_next_sibling=function(n){var r;return null==n&&(n=i),null!=n&&(r=e.treeControl.get_next_sibling(n),null!=r)?e.treeControl.onSelectBranch(r):i},e.treeControl.select_prev_sibling=function(n){var r;return null==n&&(n=i),null!=n&&(r=e.treeControl.get_prev_sibling(n),null!=r)?e.treeControl.onSelectBranch(r):i},e.treeControl.get_first_child=function(e){var n;return null==e&&(e=i),null!=e&&(null!=(n=e.children)?n.length:void 0)>0?e.children[0]:i},e.treeControl.get_closest_ancestor_next_sibling=function(n){var r,t;return r=e.treeControl.get_next_sibling(n),null!=r?r:(t=e.treeControl.get_parent_branch(n),e.treeControl.get_closest_ancestor_next_sibling(t))},e.treeControl.get_next_branch=function(n){var r;return null==n&&(n=i),null!=n?(r=e.treeControl.get_first_child(b),null!=r?r:r=e.treeControl.get_closest_ancestor_next_sibling(n)):i},e.treeControl.select_next_branch=function(n){var r;return null==n&&(n=i),null!=n&&(r=e.treeControl.get_next_branch(n),null!=r)?(e.treeControl.onSelectBranch(r),r):i},e.treeControl.last_descendant=function(r){var t;return n=r.children.length,0===n?r:(t=r.children[n-1],e.treeControl.last_descendant(t))},e.treeControl.get_prev_branch=function(n){var r;return null==n&&(n=i),null!=n?(r=e.treeControl.get_prev_sibling(n),null!=r?e.treeControl.last_descendant(r):(parent=e.treeControl.get_parent_branch(n),parent)):i}},e.bindFunctions()}}}])});