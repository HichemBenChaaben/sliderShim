define(["swapp","uiGrid","ui-bootstrap","socket-factory"],function(e){"use strict";e.registerController("mfUserListController",["$scope","$state","uiGridConstants","socket","$rootScope","$filter","gettext","gettextCatalog",function(e,t,i,n,o,s,l,r){e.permissions=e.$parent.modPermissions,e.pageTranslations=e.$parent.modTranslations,e.exceptions=e.$parent.modExceptions;var a='<div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" ng-mouseenter="getExternalScopes().rowHover(row)"  ng-mouseleave="getExternalScopes().rowHover(row)" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div>';e.configureGrid=function(){var t=e.setEditPortalTemplate(),i={un:l("Username"),fn:l("First Name"),ln:l("Last Name"),po:l("Position"),pn:l("Phone Number"),el:l("Email"),dt:l("Department"),ep:l("Edit Portal"),ap:l("Access Portal"),rd:l("Received")};e.gridOptions={};var n={paginationPageSizes:[10,25,50,100,150,200],paginationPageSize:10,enableFiltering:!1,enableRowSelection:!1,enableRowHeaderSelection:!1,multiSelect:!1,rowTemplate:a,columnDefs:[{field:"username",displayName:r.getString(i.un),width:"9%",enableColumnMenu:!1,visible:!e.exceptions.mfUserListUserName},{field:"firstname",displayName:r.getString(i.fn),width:"9%",enableColumnMenu:!1,visible:!e.exceptions.mfUserListFirstName},{field:"lastname",displayName:r.getString(i.ln),width:"9%",enableColumnMenu:!1,visible:!e.exceptions.mfUserListLastName},{field:"title",displayName:r.getString(i.po),width:"7%",enableColumnMenu:!1,visible:!e.exceptions.mfUserListPosition},{field:"phone",displayName:r.getString(i.pn),width:"11%",enableColumnMenu:!1,visible:!e.exceptions.mfUserListPhoneNum},{field:"email",displayName:r.getString(i.el),width:"7%",enableColumnMenu:!1,visible:!e.exceptions.mfUserListEmail},{field:"groupName",displayName:r.getString(i.dt),width:"11%",enableColumnMenu:!1,visible:!e.exceptions.mfUserListSecGrp},{field:"editportal",displayName:r.getString(i.ep),width:"8%",cellTemplate:t,enableColumnMenu:!1,visible:!e.exceptions.mfUserListEditPortal},{field:"accessportal",displayName:r.getString(i.ap),width:"11%",cellTemplate:t,enableColumnMenu:!1,visible:!e.exceptions.mfUserListAccessPortal},{field:"lastmycomemailsent",displayName:r.getString(i.rd),width:"9%",cellTemplate:c,enableColumnMenu:!1,visible:!e.exceptions.mfUserListReceived},{field:"edit",displayName:"",width:"4%",cellTemplate:d,enableColumnMenu:!1,visible:!e.exceptions.mfUserListAction},{field:"reset",displayName:"",width:"4%",cellTemplate:p,enableColumnMenu:!1,visible:!e.exceptions.mfUserListAction}],onRegisterApi:function(t){e.gridApi=t},exporterCsvFilename:"userListSummary.csv",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableHeaderStyle:{fontSize:9,bold:!0,italics:!0,color:"red"},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,exporterPdfHeader:{text:"PDF",style:"headerStyle"},exporterPdfFooter:function(e,t){return{text:e.toString()+" of "+t.toString(),style:"footerStyle"}},exporterPdfCustomFormatter:function(e){return e.styles.headerStyle={fontSize:22,bold:!0,margin:[8,8,8,8]},e.styles.footerStyle={fontSize:10,bold:!0},e},exporterSuppressColumns:["Action","lastmycomemailsent"],exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location"))};e.gridOptions=n,e.gridOptions.onRegisterApi=function(t){e.gridApi=t}},e.setEditPortalTemplate=function(){var t="";return t=e.permissions.isUpdateAllowed?'<div class="status_col ui-grid-cell-contents" ng-show="COL_FIELD == 0"><a ng-click="getExternalScopes().changeStatus(row,col.colDef.name)">{{getExternalScopes().getLabel("No")}}</a></div><div class="status_col ui-grid-cell-contents " ng-show="COL_FIELD != 0"><a ng-click="getExternalScopes().changeStatus(row,col.colDef.name)">{{getExternalScopes().getLabel("Yes")}}</a></div>':'<div class="status_col ui-grid-cell-contents" ng-show="COL_FIELD == 0">{{getExternalScopes().getLabel("No")}}</div><div class="status_col ui-grid-cell-contents" ng-show="COL_FIELD != 0">{{getExternalScopes().getLabel("Yes")}}</div>'};var c='<div class="status_col ui-grid-cell-contents "><a ng-click="getExternalScopes().openPopUp(row)"><img src="../assets/images/icons/mycommunity.png"></a></div>',d='<div class="ui-grid-cell-contents"><button><i ng-click="getExternalScopes().onDropDownActionClick(\'edit\',row);" class="glyphicon glyphicon-edit"></i></button></div>',p='<div class="ui-grid-cell-contents"><button><i ng-click="getExternalScopes().onDropDownActionClick(\'resetPw\',row);" class="glyphicon glyphicon-lock"></i></button></div>';e.gridColActionMenu={},e.gridColActionMenu.isDisabled=!1;var m=function(){var t={task_request:"User/getAllUsers",data:""};n.get(t).then(function(t){var i=angular.fromJson(t);e.gridOptions.data=i})};m(),e.permissions="undefined"==typeof e.$parent.modPermissions?{}:e.$parent.modPermissions,e.configureGrid(e.permissions.isUpdateAllowed),e.openPopUp=function(t){var i="";if(t.entity.lastmycomemailsent){var n=r.getString("Mycommunity welcome email was last sent from strataware to email {{entity}} on {{lastSent}}",{name:t.entity.email,lastSent:t.entity.lastmycomemailsent});i=r.getString(n),e.$parent.addAlert("SUCCESS",i)}else{var n=r.getString("Mycommunity welcome email was last sent from strataware to email {{entityEmail}}",{entityEmail:t.entity.email});i=r.getString(n),e.$parent.addAlert("ERROR",i)}},e.userListDataRequest=function(e,t){var i={task_request:e,data:t};n.get(i).then(function(e){return e})},e.changeStatus=function(t,i){var n="";"accessportal"===i?(n="User/setEditPortalToggle",t.entity.accessportal=!t.entity.accessportal,t.entity.accessportal||(t.entity.editportal=!1)):"editportal"===i&&(n="User/setEditPortalToggle",t.entity.accessportal?t.entity.editportal=!t.entity.editportal:(t.entity.editportal=!1,e.$parent.addAlert("ERROR","ACCESS"))),n&&e.userListDataRequest(n,t.entity)},e.scopeModel={onDropDownActionClick:function(t,i){return e.onDropDownActionClickFunction(t,i)},openPopUp:function(t){return e.openPopUp(t)},changeStatus:function(t,i){return e.changeStatus(t,i)},rowHover:function(e){e.isSelected=!e.isSelected},getLabel:function(e){return s("translate")(e)}},e.onDropDownActionClickFunction=function(i,s){switch(i){case"edit":o.editingUser=s.entity,t.transitionTo("home.mfMyProfile");break;case"resetPw":if(s.entity.email){var l={task_request:"User/setUserPw",data:{resetPw:1,pwrule:s.entity.pwConditions,userId:s.entity.userid,client_id:swGlobals.clientId}};n.get(l).then(function(t){1===t?e.$parent.addAlert("SUCCESS","SUCCESS"):e.$parent.addAlert("ERROR","ERROR")})}else e.$parent.addAlert("ERROR","ERROR")}},e.exportGrid=function(t){"csv"===t?e.gridApi.exporter.csvExport("all","all"):"pdf"===t&&e.gridApi.exporter.pdfExport("all","all")}}])});