define(["swapp","uiGrid","ui-bootstrap","socket-factory","/swapp/directives/address/address-directives.js","/swapp/directives/address-book/address-book-picker-directive.js"],function(e){"use strict";e.registerController("mfWaivedPenaltiesController",["$scope","$state","$rootScope","uiGridConstants","socket","gettext","gettextCatalog",function(e,t,a,i,r,n,d){e.permissions=e.$parent.modPermissions,e.exceptions=e.$parent.modExceptions,e.gridColActionMenu={},e.gridColActionMenu.isDisabled=!1,e.dateFormat=e.$parent.localTimeFormat,e.modal={},e.$on("selectedProperty",function(t,a){g(e.$parent.propertySelected.cts)}),e.$on("LanguageUpdated",function(){e.gridApi.core.notifyDataChange(i.dataChange.ROW)});var s='<div class="ui-grid-cell-contents">{{COL_FIELD | date:getExternalScopes().dateFormat}}</div>',o='<div class="ui-grid-cell-contents"><a ng-click="getExternalScopes().onEditClick(row);" ng-show="getExternalScopes().getPermissions(\'isUpdateAllowed\')">{{COL_FIELD}}</a></div>',l='<div class="ui-grid-cell-contents"><span class="glyphicon glyphicon-edit" ng-click="getExternalScopes().onEditClick(row);" ng-show="getExternalScopes().getPermissions(\'isUpdateAllowed\')"></span></div>',p='<div class="ui-grid-cell-contents"><span class="glyphicon glyphicon-trash" ng-click="getExternalScopes().deleteWaivedPenalties(row);" ng-show="getExternalScopes().getPermissions(\'isUpdateAllowed\')"></span></div>',c='<div class="ui-grid-cell-contents"></div>',u='<div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name"   ng-mouseenter="getExternalScopes().rowHover(row)"  ng-mouseleave="getExternalScopes().rowHover(row)" class="ui-grid-cell"   ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell> </div>';e.scopeModel={onEditClick:function(t){e.$parent.toggleOverlay(!0),_.size(t)?(e.modal.newPage=!1,e.updateWaivedPenalties=angular.copy(t.entity),e.$parent.initAddressDirective(e.updateWaivedPenalties.partypostc,e.updateWaivedPenalties.partysuburb,"address1"),e.updateWaivedPenalties.updatewp=1,e.updateWaivedPenalties.rdate=new Date(e.updateWaivedPenalties.rdate).getTime(),e.updateWaivedPenalties.resdate=new Date(e.updateWaivedPenalties.resdate).getTime()):(e.modal.newPage=!0,e.updateWaivedPenalties=e.buildDefaultVO(),e.$parent.initAddressDirective("","","address1"),e.updateWaivedPenalties.insertwp=1)},dateFormat:e.dateFormat,getPermissions:function(t){return e.permissions[t]},decimalFix:function(e){return e>=0?parseFloat(e).toFixed(2):void 0},deleteWaivedPenalties:function(t){var a=n("Are you sure you want to delete this entry?");return confirm(d.getString(a))?(e.initiateDeleteRequest(t.entity),!0):!1},rowHover:function(e){e.isSelected=!e.isSelected}},e.initiateDeleteRequest=function(t){for(var a,i=0;i<e.gridOptions.data.length;i++)if(t.recordid===e.gridOptions.data[i].recordid){a=i;break}var n={task_request:"Property/removeWaivedPenalties",data:t};r.get(n).then(function(t){1===t.status?(e.gridOptions.data.splice(a,1),e.$parent.filterTrigger(e.gridOptions.data,e),e.$parent.addAlert("SUCCESS","DELETE")):e.$parent.addAlert("ERROR","DELETE")})},e.$on("updateAddress",function(t,a){e.updateWaivedPenalties.partypostc=a.pc,e.updateWaivedPenalties.partysuburb=a.locality}),e.saveWaivedPenalties=function(t){if(t){void 0===e.updateWaivedPenalties.ntype&&(e.updateWaivedPenalties.ntype=""),void 0===e.updateWaivedPenalties.status&&(e.updateWaivedPenalties.status="");var a={task_request:"Property/setWaivedPenalties",data:e.$parent.unformatDate(e.updateWaivedPenalties)};r.get(a).then(function(t){if(1===t.status){if(e.modal.newPage===!0)e.updateWaivedPenalties.recordid=t.recordid.result,_.isArray(e.gridOptions.data)||(e.gridOptions.data=[]),e.gridOptions.data.push(e.$parent.formatDate(e.updateWaivedPenalties)),e.filterTrigger(e.gridOptions.data,e);else{var a=e.gridOptions.data.indexOf(e.updateWaivedPenalties);e.gridOptions.data.splice(a,1,e.$parent.formatDate(e.updateWaivedPenalties))}e.modal.newPage?e.$parent.addAlert("SUCCESS","INSERT"):e.$parent.addAlert("SUCCESS","UPDATE")}else e.modal.newPage?e.$parent.addAlert("ERROR","INSERT"):e.$parent.addAlert("ERROR","UPDATE")}),e.$parent.toggleOverlay(!1)}},e.cancel=function(){e.$parent.toggleOverlay(!1)},e.deletePenalty=function(t){var a=n("Are you sure you want to delete this entry?");return confirm(d.getString(a))?(e.initiateDeleteRequest(t),e.$parent.toggleOverlay(!1),!0):!1};({tl:n("Title"),rDate:n("Recorded Date"),name:n("Name")});e.configureGrid=function(){e.gridOptions={};var t={useExternalSorting:!0,enableFiltering:!1,rowTemplate:u,enableColumnResizing:!0,paginationPageSizes:[50,100,150,200],paginationPageSize:50,enableGridMenu:!1,enableRowSelection:!1,enableRowHeaderSelection:!1,multiSelect:!1,exporterLinkLabel:"get your csv here",exporterCsvFilename:"waivedPenalty.csv",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[10,10,10,10]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfHeader:{text:"Waived Penalities",style:"headerStyle"},exporterPdfCustomFormatter:function(e){return e.styles.headerStyle={fontSize:22,bold:!0},e.styles.footerStyle={fontSize:10,bold:!0},e},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),columnDefs:[{field:"title",displayName:d.getString("Title"),visible:!e.exceptions.mfPropWaivedPenaltiesTitle,width:"22%",enableColumnMenu:!1,cellTemplate:o},{field:"rdate",displayName:d.getString("Recorded Date"),width:"22%",visible:!e.exceptions.mfPropWaivedPenaltiesRecordedDate,enableColumnMenu:!1,cellTemplate:s},{field:"partyname",displayName:d.getString("Name"),width:"10%",visible:!e.exceptions.mfPropWaivedPenaltiesName,enableColumnMenu:!1},{field:"Edit",headerCellTemplate:c,width:50,enableFiltering:!1,visible:e.permissions.isUpdateAllowed,cellTemplate:l,enableColumnMenu:!1},{field:"Delete",width:50,headerCellTemplate:c,enableFiltering:!1,enableColumnMenu:!1,visible:e.permissions.isDeleteAllowed,cellTemplate:p}]};e.gridOptions=t,e.gridOptions.onRegisterApi=function(t){e.gridApi=t}},e.configureGrid();var g=function(t){var a={task_request:"Property/getWaivedPenalties",data:{cts:t}};r.get(a).then(function(t){t.hasOwnProperty("status")?e.$parent.addAlert("ERROR","PROPERTY"):(t=angular.fromJson(t),t=e.$parent.formatDate(t),e.gridOptions.data=t,e.$parent.filterTrigger(e.gridOptions.data,e),e.hasLoaded=!0)})};g(e.$parent.propertySelected.cts),e["export"]=function(t){"csv"===t?e.gridApi.exporter.csvExport("all","all"):"pdf"===t&&e.gridApi.exporter.pdfExport("all","all")},e.buildDefaultVO=function(){return{cts:e.$parent.propertySelected.cts,note:"",partyaddress:"",partyname:"",partyphone:"",partypostc:"",partysuburb:"",rdate:(new Date).getTime(),recordid:0,resdate:(new Date).getTime(),resolution:"",title:""}},e.addressPickerOpenStatus={isopen:!1},e.toggleDropdown=function(t){t.preventDefault(),t.stopPropagation(),e.addressPickerOpenStatus.isopen||(e.addressPickerOpenStatus.isopen=!e.addressPickerOpenStatus.isopen),a.$broadcast("fetchAddressBookPickerData",e.addressBookConfig)},e.resetForm=function(e){e&&(e.$setPristine(),e.$setUntouched())},e.$on("addressKeySet",function(t,a){e.updateWaivedPenalties.partyname=a,e.updateWaivedPenalties.partyaddress=a.address,e.updateWaivedPenalties.partysuburb=a.location,e.updateWaivedPenalties.partypostc=a.postcode,e.$parent.initAddressDirective(e.updateWaivedPenalties.partypostc,e.updateWaivedPenalties.partysuburb,"address1"),e.addressPickerOpenStatus.isopen=!e.addressPickerOpenStatus.isopen}),e.addressBookConfig={cts:e.$parent.propertySelected.cts,clientId:a.userLoginDetailsVO.clientId,defaultContactType:"",defaultIndustryType:"",permissions:{isAddAllowed:!0,isEditContactTypeAllowed:!0,isEditIndustryTypeAllowed:!0}}}])});