"use strict";angular.module("wysiwyg.module",["colorpicker.module"]).directive("wysiwyg",["$timeout",function(t){return{template:'<div><style>	.wysiwyg-btn-group-margin{  margin-right:5px; }	.wysiwyg-select{ height:30px;margin-bottom:1px;}	.wysiwyg-colorpicker{ font-family: arial, sans-serif !important;font-size:16px !important; padding:2px 10px !important;}</style><div class="btn-group btn-group-sm wysiwyg-btn-group-margin"><button title="Bold" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'bold\')" ng-class="{ active: isBold}"><i class="fa fa-bold"></i></button><button title="Italic" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'italic\')" ng-class="{ active: isItalic}"><i class="fa fa-italic"></i></button><button title="Underline" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'underline\')" ng-class="{ active: isUnderlined}"><i class="fa fa-underline"></i></button><button title="Strikethrough" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'strikethrough\')" ng-class="{ active: isStrikethrough}"><i class="fa fa-strikethrough"></i></button><button title="Subscript" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'subscript\')" ng-class="{ active: isSubscript}"><i class="fa fa-subscript"></i></button><button title="Superscript" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'superscript\')" ng-class="{ active: isSuperscript}"><i class="fa fa-superscript"></i></button></div><div class="btn-group btn-group-sm wysiwyg-btn-group-margin"><select tabindex="-1"  unselectable="on" class="form-control wysiwyg-select" ng-model="font" ng-options="f for f in fonts" ng-change="setFont()"></select></div><div class="btn-group btn-group-sm wysiwyg-btn-group-margin"><select unselectable="on" tabindex="-1" class="form-control wysiwyg-select" ng-model="fontSize" ng-options="f.size for f in fontSizes" ng-change="setFontSize()"></select></div><div class="btn-group btn-group-sm wysiwyg-btn-group-margin"><button title="Font Color" tabindex="-1" colorpicker="rgba" type="button" colorpicker-position="top" class="btn btn-default ng-valid ng-dirty wysiwyg-colorpicker wysiwyg-fontcolor" ng-model="fontColor" ng-change="setFontColor()">A</button><button title="Hilite Color" tabindex="-1" colorpicker="rgba" type="button" colorpicker-position="top" class="btn btn-default ng-valid ng-dirty wysiwyg-colorpicker wysiwyg-hiliteColor" ng-model="hiliteColor" ng-change="setHiliteColor()">H</button></div><div class="btn-group btn-group-sm wysiwyg-btn-group-margin"><button title="Remove Formatting" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'removeFormat\')" ><i class="fa fa-eraser"></i></button></div><div class="btn-group btn-group-sm wysiwyg-btn-group-margin"><button title="Ordered List" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'insertorderedlist\')" ng-class="{ active: isOrderedList}"><i class="fa fa-list-ol"></i></button><button title="Unordered List" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'insertunorderedlist\')" ng-class="{ active: isUnorderedList}"><i class="fa fa-list-ul"></i></button><button title="Outdent" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'outdent\')"><i class="fa fa-outdent"></i></button><button title="Indent" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'indent\')"><i class="fa fa-indent"></i></button></div><div class="btn-group btn-group-sm wysiwyg-btn-group-margin"><button title="Left Justify" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'justifyleft\')" ng-class="{ active: isLeftJustified}"><i class="fa fa-align-left"></i></button><button title="Center Justify" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'justifycenter\')" ng-class="{ active: isCenterJustified}"><i class="fa fa-align-center"></i></button><button title="Right Justify" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'justifyright\')" ng-class="{ active: isRightJustified}"><i class="fa fa-align-right"></i></button></div><div class="btn-group btn-group-sm wysiwyg-btn-group-margin"><button title="Code" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'formatblock\', \'pre\')"  ng-class="{ active: isPre}"><i class="fa fa-code"></i></button><button title="Quote" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'formatblock\', \'blockquote\')"  ng-class="{ active: isBlockquote}"><i class="fa fa-quote-right"></i></button><button title="Paragragh" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'insertParagraph\')"  ng-class="{ active: isParagraph}">P</button></div><div class="btn-group btn-group-sm wysiwyg-btn-group-margin" ><button ng-show="!isLink" tabindex="-1" title="Link" type="button" unselectable="on" class="btn btn-default" ng-click="createLink()"><i class="fa fa-link" ></i> </button><button ng-show="isLink" tabindex="-1" title="Unlink" type="button" unselectable="on" class="btn btn-default" ng-click="format(\'unlink\')"><i class="fa fa-unlink"></i> </button><button title="Image" tabindex="-1" type="button" unselectable="on" class="btn btn-default" ng-click="onImagePopup()"><i class="fa fa-picture-o"></i> </button><button title="Image" tabindex="-1" type="button" unselectable="on" class="btn btn-default" style="visibility:hidden" ng-click="insertImage()"><i class="fa fa-picture-o"></i> </button></div><div id="{{textareaId}}" style="resize:vertical;height:{{textareaHeight || \'80px\'}}; overflow:auto" contentEditable="true" class="{{textareaClass}} wysiwyg-textarea" rows="{{textareaRows}}" name="{{textareaName}}" required="{{textareaRequired}}" placeholder="{{textareaPlaceholder}}" ng-model="value"></div></div>',restrict:"E",scope:{value:"=ngModel",textareaHeight:"@textareaHeight",textareaName:"@textareaName",textareaPlaceholder:"@textareaPlaceholder",textareaClass:"@textareaClass",textareaRequired:"@textareaRequired",textareaId:"@textareaId"},replace:!0,require:"ngModel",link:function(e,n,i,a){function o(t){var e=window.getSelection().getRangeAt(0);return e&&(e.startContainer.parentNode.tagName===t.toUpperCase()||e.endContainer.parentNode.tagName===t.toUpperCase())?!0:!1}function s(){var t=window.getSelection().getRangeAt(0);if(t){var e=$(t.startContainer.parentNode).attr("style");if(!angular.isDefined(e))return!1;for(var n=e.split(";"),i=0;i<n.length;i++){var a=n[i].split(":");if("background-color"===a[0])return a[1]}return"#fff"}return"#fff"}var l=n.find("div.wysiwyg-textarea");e.fonts=["Georgia","Palatino Linotype","Times New Roman","Arial","Helvetica","Arial Black","Comic Sans MS","Impact","Lucida Sans Unicode","Tahoma","Trebuchet MS","Verdana","Courier New","Lucida Console","Helvetica Neue"].sort(),e.font=e.fonts[6],e.fontSizes=[{value:"1",size:"10px"},{value:"2",size:"13px"},{value:"3",size:"16px"},{value:"4",size:"18px"},{value:"5",size:"24px"},{value:"6",size:"32px"},{value:"7",size:"48px"}],e.fontSize=e.fontSizes[1],"true"===i.enableBootstrapTitle&&void 0!==i.enableBootstrapTitle&&n.find("button[title]").tooltip({container:"body"}),l.on("keyup mouseup",function(){e.$apply(function(){var t=l.html();"<br>"==t&&(t=""),a.$setViewValue(t)})}),e.isLink=!1,l.on("click keyup focus mouseup",function(){t(function(){e.isBold=e.cmdState("bold"),e.isUnderlined=e.cmdState("underline"),e.isStrikethrough=e.cmdState("strikethrough"),e.isItalic=e.cmdState("italic"),e.isSuperscript=o("SUP"),e.isSubscript=o("SUB"),e.isRightJustified=e.cmdState("justifyright"),e.isLeftJustified=e.cmdState("justifyleft"),e.isCenterJustified=e.cmdState("justifycenter"),e.isPre="pre"==e.cmdValue("formatblock"),e.isBlockquote="blockquote"==e.cmdValue("formatblock"),e.isOrderedList=e.cmdState("insertorderedlist"),e.isUnorderedList=e.cmdState("insertunorderedlist"),e.fonts.forEach(function(t,n){return e.cmdValue("fontname").indexOf(t)>-1?(e.font=t,!1):void 0}),e.fontSizes.forEach(function(t,n){return e.cmdValue("fontsize")===t.value?(e.fontSize=t,!1):void 0}),e.hiliteColor=s(),n.find("button.wysiwyg-hiliteColor").css("background-color",e.hiliteColor),e.fontColor=e.cmdValue("forecolor"),n.find("button.wysiwyg-fontcolor").css("color",e.fontColor),e.isLink=o("A")},10)}),a.$render=function(){l.html(a.$viewValue)},e.format=function(t,e){document.execCommand(t,!1,e)},e.cmdState=function(t,e){return document.queryCommandState(t)},e.cmdValue=function(t){return document.queryCommandValue(t)},e.createLink=function(){var t=prompt("Enter the link URL");t&&void 0!==t&&e.format("createlink",t)},e.insertImage=function(){var t=prompt("Enter the image URL");t&&void 0!==t&&e.format("insertimage",t)},e.onImagePopup=function(){e.$parent.onImageClick(e)},e.setFont=function(){e.format("fontname",e.font)},e.setFontSize=function(){e.format("fontsize",e.fontSize.value)},e.setFontColor=function(){e.format("forecolor",e.fontColor)},e.setHiliteColor=function(){e.format("hiliteColor",e.hiliteColor)},e.format("enableobjectresizing",!0)}}}]);