"use strict";define(["swapp","uiGrid","/assets/vendor/csv-js/csv.js","/assets/vendor/pdfMake/index.js","/swapp/directives/validation/arabic-numerals.js","/swapp/directives/format-currency/format-currency.js"],function(e){e.registerController("mfInsuranceClaimsController",["$scope","socket","$rootScope","$filter","swAppConstants","gettext","gettextCatalog",function(e,t,a,r,i,n,s){function o(){var a={task_request:"Property/getInsuranceClaims",data:{cts:e.$parent.propertySelected.cts}};t.get(a).then(function(t){var a=[];angular.forEach(t,function(t){t=e.$parent.formatDate(t),t.reportedtopolice=t.reportedtopolice?!0:!1,t.ispolicereport=t.ispolicereport?!0:!1,t.status=s.getString(t.status),a.push(t)}),e.gridOptions.data=a,e.$parent.filterTrigger(e.gridOptions.data,e),e.hasLoaded=!0})}e.insurance={},e.claims={},e.permissions=e.$parent.modPermissions,e.exceptions=e.$parent.modExceptions,e.dateFormat=e.$parent.localTimeFormat,e.modal={};var l='<div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" ng-mouseenter="getExternalScopes().rowHover(row)"  ng-mouseleave="getExternalScopes().rowHover(row)" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div>',d='<div class="ui-grid-cell-contents"><i class="glyphicon glyphicon-edit" ng-click="getExternalScopes().openModal(row.entity);modal.isNewPage=false"></i></div>',c='<div class="ui-grid-cell-contents"><i class="glyphicon glyphicon-trash" ng-click="getExternalScopes().deleteClaim(row.entity);"></i></div>';e["export"]=function(t){"csv"===t?e.gridApi.exporter.csvExport("all","all"):"pdf"===t&&e.gridApi.exporter.pdfExport("all","all")};var p={task_request:"Property/getPolicyNumbers",data:{cts:e.$parent.propertySelected.cts}};t.get(p).then(function(t){e.policyNumbers=e.$parent.formatDate(angular.fromJson(t))}),e.initiateDeleteRequest=function(a){for(var r,i=0;i<e.gridOptions.data.length;i++)if(a.recordid===e.gridOptions.data[i].recordid){r=i;break}var n={task_request:"Property/removeInsuranceClaim",data:{claim_id:a.recordid}};t.get(n).then(function(t){1===t.success?(e.gridOptions.data.splice(r,1),e.$parent.filterTrigger(e.gridOptions.data,e),e.$parent.addAlert("SUCCESS","DELETE")):e.$parent.addAlert("ERROR","DELETE")})},e.states={openModal:function(t){e.insurance=t,e.origRecord=angular.copy(t),"undefined"==typeof t&&(e.insurance.sdate=r("date")((new Date).getTime(),e.dateFormat),e.insurance.rdate=r("date")((new Date).getTime(),e.dateFormat),e.insurance.rtpdate=r("date")(new Date("Sat, 01 Jan 2000 00:00:00 GMT"),e.dateFormat)),0===e.insurance.resdate&&(e.insurance.resdate=null),e.$parent.toggleOverlay(!0)},deleteClaim:function(t){var a=n("Are you sure you want to delete this entry?");return confirm(s.getString(a))?(e.initiateDeleteRequest(t),!0):!1},rowHover:function(e){e.isSelected=!e.isSelected}};var u={tl:n("Title"),dt:n("Submitted Date"),tp:n("Type"),st:n("Status")};e.gridOptions={enableColumnResizing:!0,paginationPageSizes:i.GRID_PAGINATION_SIZE,paginationPageSize:i.GRID_ROWS_NUM,rowTemplate:l,columnDefs:[{field:"title",displayName:s.getString(u.tl),enableColumnMenu:!1,width:"15%",visible:!e.exceptions.mfInsuranceClaimsTitle},{field:"sdate",displayName:s.getString(u.dt),enableColumnMenu:!1,cellFilter:'date:"'+e.dateFormat+'"',width:"15%",visible:!e.exceptions.mfInsuranceClaimsSubmitted},{field:"ntype",displayName:s.getString(u.tp),enableColumnMenu:!1,width:"25%",visible:!e.exceptions.mfInsuranceClaimsType},{field:"status",displayName:s.getString(u.st),enableColumnMenu:!1,width:"25%",visible:!e.exceptions.mfInsuranceClaimsStatus},{field:"edit",enableColumnMenu:!1,displayName:"",width:50,cellTemplate:d,visible:e.permissions.isUpdateAllowed},{field:"delete",enableColumnMenu:!1,displayName:"",width:50,cellTemplate:c,visible:e.permissions.isDeleteAllowed}],onRegisterApi:function(t){e.gridApi=t}};var p={task_request:"Property/getInsuranceClaimTypes",data:{region_id:a.userLoginDetailsVO.regionId}};t.get(p).then(function(t){e.claims.types=t}),o(),e.$on("selectedProperty",function(e,t){o()}),e.resetForm=function(e){e&&(e.$setPristine(),e.$setUntouched())},e.save=function(){if(angular.equals(e.origRecord,e.insurance))return void e.$parent.toggleOverlay(!1);var a=e.$parent.unformatDate(angular.copy(e.insurance));a.reportedtopolice=+a.reportedtopolice,a.ispolicereport=+a.ispolicereport,a.cts=e.$parent.propertySelected.cts,a.claimamount=parseInt(e.insurance.claimamount.replace(/[^0-9-.]/g,""),10),e.$parent.toggleOverlay(!1);var r={task_request:"Property/setInsuranceClaim",data:a};t.get(r).then(function(t){t?(e.$parent.addAlert("SUCCESS","SUCCESS"),_.isArray(e.gridOptions.data)||(e.gridOptions.data=[]),e.gridOptions.data.push(e.$parent.formatDate(e.updateContEng)),e.$parent.filterTrigger(e.gridOptions.data,e)):e.$parent.addAlert("ERROR","ERROR"),o()})}}])});