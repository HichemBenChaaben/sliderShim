define(["swapp","uiGrid","ui-bootstrap","socket-factory","/swapp/directives/address/address-directives.js","/swapp/directives/address-book/address-book-picker-directive.js"],function(e){"use strict";e.registerController("mfNoticesOrOrdersController",["$scope","$state","$rootScope","uiGridConstants","socket","gettext","gettextCatalog",function(e,t,r,i,s,a,o){e.permissions=e.$parent.modPermissions,e.exceptions=e.$parent.modExceptions,e.dateFormat=e.$parent.localTimeFormat,e.modal={},e.$on("selectedProperty",function(){g(e.$parent.propertySelected.cts)});var d='<div class="ui-grid-cell-contents">{{COL_FIELD | date:getExternalScopes().dateFormat}}</div>',n='<div class="ui-grid-cell-contents"><span class="glyphicon glyphicon-edit" ng-click="getExternalScopes().openModal(row.entity);modal.isNewPage=false" ng-show="getExternalScopes().getPermissions(\'isUpdateAllowed\')"></span></div>',l='<div class="ui-grid-cell-contents"><span class="glyphicon glyphicon-trash" ng-click="getExternalScopes().deleteNoticesOrOrders(row);" ng-show="getExternalScopes().getPermissions(\'isUpdateAllowed\')"></span></div>',p='<div class="ui-grid-cell-contents"></div>',c='<div ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name"   ng-mouseenter="getExternalScopes().rowHover(row)"  ng-mouseleave="getExternalScopes().rowHover(row)" class="ui-grid-cell"   ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell> </div>';e.states={openModal:function(t){e.updateNoticesOrOrders=t,_.size(t)?(e.updateNoticesOrOrders.update_notice_or_orders=1,e.$parent.initAddressDirective(e.updateNoticesOrOrders.partypostc,e.updateNoticesOrOrders.partysuburb,"address1"),e.updateNoticesOrOrders.rdate=new Date(e.updateNoticesOrOrders.rdate).getTime(),e.updateNoticesOrOrders.resdate=new Date(e.updateNoticesOrOrders.resdate).getTime()):(e.updateNoticesOrOrders=e.buildDefaultVO(),e.updateNoticesOrOrders.update_notice_or_orders=0,e.$parent.initAddressDirective("","","address1")),e.$parent.toggleOverlay(!0)},dateFormat:e.dateFormat,getPermissions:function(t){return e.permissions[t]},decimalFix:function(e){return e>=0?parseFloat(e).toFixed(2):void 0},deleteNoticesOrOrders:function(t){var r=a("Are you sure you want to delete this entry?");return confirm(o.getString(r))?void e.initiateDeleteRequest(t.entity):!1},rowHover:function(e){e.isSelected=!e.isSelected}},e.initiateDeleteRequest=function(t){for(var r,i=0;i<e.gridOptions.data.length;i++)if(t.recordid===e.gridOptions.data[i].recordid){r=i;break}var a={task_request:"Property/removeNoticeOrOrders",data:{recordid:t.recordid}};s.get(a).then(function(t){1===t.result?(e.gridOptions.data.splice(r,1),e.$parent.filterTrigger(e.gridOptions.data,e),e.$parent.addAlert("SUCCESS","DELETE")):e.$parent.addAlert("ERROR","DELETE")})},e.$on("updateAddress",function(t,r){e.updateNoticesOrOrders.partypostc=r.pc,e.updateNoticesOrOrders.partysuburb=r.locality}),e.saveNoticesOrOrders=function(t){var r;if(r=e.modal.isNewPage?e.permissions.isCreateAllowed:e.permissions.isUpdateAllowed,t&&r){var i={task_request:"Property/setNoticeOrOrders",data:e.$parent.unformatDate(e.updateNoticesOrOrders)};s.get(i).then(function(t){if(1===t.result)if(e.modal.isNewPage)e.updateNoticesOrOrders.recordid=t.details,_.size(e.gridOptions.data)||(e.gridOptions.data=[]),e.gridOptions.data.push(e.$parent.formatDate(e.updateNoticesOrOrders)),e.filterTrigger(e.gridOptions.data,e),e.$parent.addAlert("SUCCESS","INSERT");else{var r=e.gridOptions.data.indexOf(e.updateNoticesOrOrders);e.gridOptions.data.splice(r,1,e.$parent.formatDate(e.updateNoticesOrOrders)),e.$parent.addAlert("SUCCESS","UPDATE")}else e.$parent.addAlert("ERROR","ERROR")}),e.$parent.toggleOverlay(!1)}};var u={ds:a("Description"),od:a("Ordered"),rd:a("Received"),tp:a("Type")};e.configureGrid=function(){e.gridOptions={};var t={useExternalSorting:!0,enableFiltering:!1,rowTemplate:c,enableColumnResizing:!0,paginationPageSizes:[50,100,150,200],paginationPageSize:50,enableGridMenu:!1,enableRowSelection:!1,enableRowHeaderSelection:!1,multiSelect:!1,exporterLinkLabel:"get your csv here",exporterCsvFilename:"notice-or-order.csv",exporterPdfDefaultStyle:{fontSize:9},exporterPdfTableStyle:{margin:[10,10,10,10]},exporterPdfTableHeaderStyle:{fontSize:10,bold:!0,italics:!0,color:"red"},exporterPdfHeader:{text:"Notice Or Orders",style:"headerStyle"},exporterPdfCustomFormatter:function(e){return e.styles.headerStyle={fontSize:22,bold:!0},e.styles.footerStyle={fontSize:10,bold:!0},e},exporterPdfOrientation:"portrait",exporterPdfPageSize:"LETTER",exporterPdfMaxGridWidth:500,exporterCsvLinkElement:angular.element(document.querySelectorAll(".custom-csv-link-location")),columnDefs:[{field:"note",displayName:o.getString(u.ds),width:"22%",visible:!e.exceptions.mfNoticesOrOrdersDescription,enableColumnMenu:!1},{field:"odate",displayName:o.getString(u.od),width:"22%",visible:!e.exceptions.mfNoticesOrOrdersOrdered,enableColumnMenu:!1,cellTemplate:d},{field:"rdate",displayName:o.getString(u.rd),width:"22%",visible:!e.exceptions.mfNoticesOrOrdersReceived,enableColumnMenu:!1,cellTemplate:d},{field:"ntype",displayName:o.getString(u.tp),width:"10%",visible:!e.exceptions.mfNoticesOrOrdersType,enableColumnMenu:!1},{field:"Edit",headerCellTemplate:p,displayName:"",width:50,enableFiltering:!1,visible:e.permissions.isUpdateAllowed,cellTemplate:n,enableColumnMenu:!1},{field:"Delete",displayName:"",width:50,visible:e.permissions.isDeleteAllowed,headerCellTemplate:p,enableFiltering:!1,enableColumnMenu:!1,cellTemplate:l}]};e.gridOptions=t,e.gridOptions.onRegisterApi=function(t){e.gridApi=t}},e.configureGrid();var g=function(t){var r={task_request:"Property/getNoticeOrOrders",data:{cts:t}};s.get(r).then(function(t){t&&(t=angular.fromJson(t),t=e.$parent.formatDate(t),_.has(t,"status")||(e.gridOptions.data=t),e.$parent.filterTrigger(t,e))})};g(e.$parent.propertySelected.cts),e["export"]=function(t){"csv"===t?e.gridApi.exporter.csvExport("all","all"):"pdf"===t&&e.gridApi.exporter.pdfExport("all","all")},e.buildDefaultVO=function(){return{cts:e.$parent.propertySelected.cts,note:"",ntype:"",partyaddress:"",partyname:"",partyphone:"",partypostc:"",partysuburb:"",rdate:(new Date).getTime(),odate:(new Date).getTime(),recordid:"",resdate:(new Date).getTime(),resolution:"",status:"",title:""}},e.addressPickerOpenStatus={isopen:!1},e.toggleDropdown=function(t){t.preventDefault(),t.stopPropagation(),e.addressPickerOpenStatus.isopen||(e.addressPickerOpenStatus.isopen=!e.addressPickerOpenStatus.isopen),r.$broadcast("fetchAddressBookPickerData",e.addressBookConfig)},e.$on("addressKeySet",function(t,r){e.updateNoticesOrOrders.partyname=r,e.addressPickerOpenStatus.isopen=!e.addressPickerOpenStatus.isopen}),e.addressBookConfig={cts:e.$parent.propertySelected.cts,clientId:r.userLoginDetailsVO.clientId,defaultContactType:"",defaultIndustryType:"",permissions:{isAddAllowed:!0,isEditContactTypeAllowed:!0,isEditIndustryTypeAllowed:!0}}}])});